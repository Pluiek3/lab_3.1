/**
 * @file sleep_logic.c
 * @brief –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥–∏–∫–∏ —Ä–∞—Å—á–µ—Ç–∞ —Å–Ω–∞
 */

#include "../include/sleep_logic.h"
#include <math.h>

/**
 * @brief –ü–æ–ª—É—á–∞–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ –∫–∞—á–µ—Å—Ç–≤–µ —Å–Ω–∞
 * @param hours –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å–æ–≤ —Å–Ω–∞
 * @return –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤ –≤–∏–¥–µ —Å—Ç—Ä–æ–∫–∏
 * 
 * –§—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —á–∞—Å–æ–≤ —Å–Ω–∞:
 * - –ú–µ–Ω–µ–µ 4 —á–∞—Å–æ–≤: –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
 * - 4-6 —á–∞—Å–æ–≤: –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
 * - 6-8 —á–∞—Å–æ–≤: –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
 * - 8-10 —á–∞—Å–æ–≤: –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
 * - –ë–æ–ª–µ–µ 10 —á–∞—Å–æ–≤: –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –ø–µ—Ä–µ—Å—ã–ø–µ
 */
static const char* get_sleep_comment(double hours) {
    if (hours < 4) return "üíÄ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –º–∞–ª–æ! –û—á–µ–Ω—å –≤—Ä–µ–¥–Ω–æ –¥–ª—è –∑–¥–æ—Ä–æ–≤—å—è!. P.S –í—ã —Å–ª—É—á–∞–π–Ω–æ –Ω–µ –ñ–û–ü?";
    else if (hours < 6)  return "‚ö†Ô∏è –ú–∞–ª–æ–≤–∞—Ç–æ... –°—Ç–∞—Ä–∞–π—Ç–µ—Å—å —Å–ø–∞—Ç—å –±–æ–ª—å—à–µ.";
    else if (hours < 8)  return "üòê –ù–æ—Ä–º–∞–ª—å–Ω–æ, –Ω–æ –º–æ–∂–Ω–æ –ª—É—á—à–µ.";
    else if (hours < 10) return "üòä –û—Ç–ª–∏—á–Ω–æ! –ò–¥–µ–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–Ω–∞.";
    return "ü§î –ü–µ—Ä–µ–±–æ—Ä! –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—Ä–µ–¥–Ω–æ.";
}

/**
 * @brief –í—ã—á–∏—Å–ª—è–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–Ω–∞ –∏ –¥–∞–µ—Ç –æ—Ü–µ–Ω–∫—É
 * @param data –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç—Ö–æ–¥–∞ –∫–æ —Å–Ω—É –∏ –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏—è
 * @return –°—Ç—Ä—É–∫—Ç—É—Ä–∞ SleepResult —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ —Ä–∞—Å—á–µ—Ç–∞
 * 
 * –§—É–Ω–∫—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è:
 * 1. –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –≤—Ä–µ–º—è –≤ –º–∏–Ω—É—Ç—ã
 * 2. –£—á–∏—Ç—ã–≤–∞–µ—Ç —Å–ª—É—á–∞–π —Å–Ω–∞ —á–µ—Ä–µ–∑ –ø–æ–ª–Ω–æ—á—å
 * 3. –í—ã—á–∏—Å–ª—è–µ—Ç –æ–±—â—É—é –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–Ω–∞
 * 4. –§–æ—Ä–º–∏—Ä—É–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ –∫–∞—á–µ—Å—Ç–≤–µ —Å–Ω–∞
 */
SleepResult calculate_sleep(SleepData data) {
    int bedtime_mins  = time_to_minutes(data.bedtime);
    int waketime_mins = time_to_minutes(data.waketime);
    
    // –£—á–µ—Ç —Å–Ω–∞ —á–µ—Ä–µ–∑ –ø–æ–ª–Ω–æ—á—å
    if (waketime_mins < bedtime_mins) {
        waketime_mins += 24 * 60;
    }
    
    int total_mins = waketime_mins - bedtime_mins;
    Time duration  = minutes_to_time(total_mins);
    
    double hours = total_mins / 60.0;
    
    return (SleepResult){
        .hours   = duration.hours,
        .minutes = duration.minutes,
        .comment = get_sleep_comment(hours)
    };
}